# –ê–Ω–∞–ª–∏–∑ –±–∞–≥–æ–≤ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —á–µ–∫–±–æ–∫—Å –ø—Ä–∏–≤—ã—á–∫–∏

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ö†Ô∏è Race Condition –ø—Ä–∏ –±—ã—Å—Ç—Ä—ã—Ö –∫–ª–∏–∫–∞—Ö
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:27-61`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ `isCompleting` –µ—Å—Ç—å, –Ω–æ –æ–Ω–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ `finally` –±–ª–æ–∫–µ
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–Ω–µ—Ç –¥–≤–∞–∂–¥—ã –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (–¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞), –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –ø—Ä–æ–π—Ç–∏
- –ù–∞ –±—ç–∫–µ–Ω–¥–µ –µ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é toggle

**–ö–æ–¥:**
```typescript
const handleComplete = async () => {
  if (isCompleting) {
    return
  }
  setIsCompleting(true)
  // ... –∑–∞–ø—Ä–æ—Å
  finally {
    setIsCompleting(false) // –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ –ø—Ä–∏–≤—ã—á–∫–∞ –±—É–¥–µ—Ç –æ—Ç–º–µ—á–µ–Ω–∞ –∏ —Å—Ä–∞–∑—É —Å–Ω—è—Ç–∞
- UI –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

### 2. üîÑ –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/App.tsx:112-137`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `handleHabitComplete` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `loadHabits()` –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
- –ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ—Å—á–µ—Ç streak), –æ–Ω–∏ –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è

**–ö–æ–¥:**
```typescript
const handleHabitComplete = (habitId: string, completed: boolean, streak?: number) => {
  setHabits(prevHabits => prevHabits.map(h => {
    if (h.id === habitId) {
      return { 
        ...h, 
        isCompletedToday: completed,
        streak: streak !== undefined ? streak : h.streak
      }
    }
    return h
  }))
  // –ù–ï–¢ –≤—ã–∑–æ–≤–∞ loadHabits() –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Streak –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —Å–µ—Ä–≤–µ—Ä–æ–º
- –î—Ä—É–≥–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è

---

### 3. ‚ö° –ü—Ä–æ–±–ª–µ–º–∞ —Å undefined streak
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:44` –∏ `frontend/src/App.tsx:122`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω–µ—Ç `streak` –≤ –æ—Ç–≤–µ—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π streak –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

**–ö–æ–¥:**
```typescript
// –í HabitItem.tsx
onComplete(habit.id, result.completed, result.streak) // result.streak –º–æ–∂–µ—Ç –±—ã—Ç—å undefined

// –í App.tsx
streak: streak !== undefined ? streak : h.streak // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π streak
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Streak –º–æ–∂–µ—Ç –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è/—Å–Ω—è—Ç–∏—è –æ—Ç–º–µ—Ç–∫–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

---

### 4. üêõ –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ –æ—Ç–∫–∞—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:46-57`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞ –Ω–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- UI –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

**–ö–æ–¥:**
```typescript
try {
  const result = await habitsApi.completeToday(habit.id)
  if (onComplete) {
    onComplete(habit.id, result.completed, result.streak)
  }
} catch (error: any) {
  // –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞, –Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞ –Ω–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
  alert(error.response?.data?.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –ø—Ä–∏–≤—ã—á–∫–∏')
} finally {
  setIsCompleting(false)
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏
- –ù–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ —Ç–æ–º, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å

---

### 5. üîÅ –ü—Ä–æ–±–ª–µ–º–∞ —Å retry –ª–æ–≥–∏–∫–æ–π
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:50-54`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ retry –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `setTimeout(() => handleComplete(), 1000)`
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –ø–æ–ø—ã—Ç–∫–∞–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –∫–ª–∏–∫–∞—Ç—å
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫

**–ö–æ–¥:**
```typescript
if (error.response?.status === 503 && error.response?.data?.retryable) {
  if (confirm('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑?')) {
    setTimeout(() => handleComplete(), 1000) // –ú–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
    return
  }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É
- –í–æ–∑–º–æ–∂–Ω—ã–µ race conditions

---

### 6. üéØ –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:27-61`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- –ü—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø–ª–æ—Ö–æ–π UX

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–ª–æ—Ö–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

---

### 7. üîí –ü—Ä–æ–±–ª–µ–º–∞ —Å toggle –ª–æ–≥–∏–∫–æ–π –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `backend/src/controllers/habits.controller.ts:444-565`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ race condition (–¥–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞) –ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ
- –ï—Å–ª–∏ –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏–¥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –æ–±–∞ –Ω–∞–π–¥—É—Ç `existingLog`, –æ–±–∞ –ø–æ–ø—ã—Ç–∞—é—Ç—Å—è —É–¥–∞–ª–∏—Ç—å –µ–≥–æ
- –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É `P2025` (record not found)

**–ö–æ–¥:**
```typescript
if (existingLog) {
  await tx.habitLog.delete({
    where: { id: existingLog.id }
  })
  return { completed: false, log: null }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ç–æ—Ä–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

### 8. üìä –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º streak
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `backend/src/controllers/habits.controller.ts:530-537`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Streak –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ü–û–°–õ–ï –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ï—Å–ª–∏ –º–µ–∂–¥—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º streak –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å, streak –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–º
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

**–ö–æ–¥:**
```typescript
const result = await prisma.$transaction(async (tx) => {
  // ... –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ª–æ–≥–æ–º
})

// –ü–µ—Ä–µ—Å—á–µ—Ç streak –í–ù–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const streak = await calculateStreak(id)
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Streak –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–º –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- Race condition –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –∏ –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º

---

### 9. üßπ –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:27-61`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–æ –≤—Ä–µ–º—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏:
  - –ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  - –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏
  - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è React –æ memory leaks

**–ö–æ–¥:**
```typescript
const handleComplete = async () => {
  setIsCompleting(true)
  try {
    const result = await habitsApi.completeToday(habit.id)
    // –ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∑–¥–µ—Å—å, setState –≤—ã–∑–æ–≤–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
    if (onComplete) {
      onComplete(habit.id, result.completed, result.streak)
    }
  } finally {
    setIsCompleting(false) // –¢–æ–∂–µ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
  }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Memory leaks
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è React –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

---

### 10. üîÑ –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –æ—Ç props –≤ useEffect
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:201-233`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `useEffect` –¥–ª—è —Ç–∞–π–º–µ—Ä–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `habit.isCompletedToday`
- –ï—Å–ª–∏ `habit` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–∑ props, –Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, —Ç–∞–π–º–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å props

**–ö–æ–¥:**
```typescript
useEffect(() => {
  if (!habit.reminderTime || !habit.reminderEnabled || habit.isCompletedToday || !isPremium) {
    setTimeUntilReminder(null)
    return
  }
  // ... –ª–æ–≥–∏–∫–∞ —Ç–∞–π–º–µ—Ä–∞
}, [habit.reminderTime, habit.reminderEnabled, habit.isCompletedToday, isPremium])
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –¢–∞–π–º–µ—Ä –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ props

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. –£–ª—É—á—à–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç race condition
- –î–æ–±–∞–≤–∏—Ç—å debounce –Ω–∞ –∫–ª–∏–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ref –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å UI –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞

### 2. –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è—Ç—å UI –ø—Ä–∏ –∫–ª–∏–∫–µ
- –û—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ

### 3. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –û—Ç–∫–∞—Ç—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —á–µ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –î–æ–±–∞–≤–∏—Ç—å retry —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ–ø—ã—Ç–æ–∫

### 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –í—ã–∑—ã–≤–∞—Ç—å `loadHabits()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 5. –£–ª—É—á—à–∏—Ç—å toggle –ª–æ–≥–∏–∫—É –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `upsert` –≤–º–µ—Å—Ç–æ `create` + `delete`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ `P2025` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 6. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å streak –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –í–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ—Å—á–µ—Ç streak –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å database trigger –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞

---

### 11. ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/HabitItem.tsx:36-45`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –∫–æ–¥ —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (`completed`, `streak`)

**–ö–æ–¥:**
```typescript
const result = await habitsApi.completeToday(habit.id)
// –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ result.completed –∏ result.streak —Å—É—â–µ—Å—Ç–≤—É—é—Ç
if (onComplete) {
  onComplete(habit.id, result.completed, result.streak)
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Runtime –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –æ—Ç–≤–µ—Ç–∞
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ü–ª–æ—Ö–æ–π UX –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ü—Ä–æ–±–ª–µ–º–∞ —Å toggle –ª–æ–≥–∏–∫–æ–π –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (#7)
2. **–í—ã—Å–æ–∫–∏–π:** Race condition –ø—Ä–∏ –±—ã—Å—Ç—Ä—ã—Ö –∫–ª–∏–∫–∞—Ö (#1)
3. **–í—ã—Å–æ–∫–∏–π:** –ü—Ä–æ–±–ª–µ–º–∞ —Å undefined streak (#3)
4. **–í—ã—Å–æ–∫–∏–π:** –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (#9)
5. **–°—Ä–µ–¥–Ω–∏–π:** –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è (#2)
6. **–°—Ä–µ–¥–Ω–∏–π:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ (#4)
7. **–°—Ä–µ–¥–Ω–∏–π:** –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (#11)
8. **–ù–∏–∑–∫–∏–π:** –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (#6)
9. **–ù–∏–∑–∫–∏–π:** Retry –ª–æ–≥–∏–∫–∞ (#5)
10. **–ù–∏–∑–∫–∏–π:** –ü–µ—Ä–µ—Å—á–µ—Ç streak (#8)
11. **–ù–∏–∑–∫–∏–π:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç props –≤ useEffect (#10)
