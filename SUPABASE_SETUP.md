# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase PostgreSQL –¥–ª—è Vercel

## ‚úÖ –ü–æ–ª—É—á–µ–Ω–Ω—ã–π DATABASE_URL

```
postgres://postgres.wftzanfybiwxuvpjpizh:W4S4YrBcTA5ZyxWS@aws-1-us-east-1.pooler.supabase.com:6543/postgres?sslmode=require&supa=base-pooler.x
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –§–æ—Ä–º–∞—Ç –¥–ª—è Prisma

Prisma —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `postgresql://` –≤–º–µ—Å—Ç–æ `postgres://`.

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è Vercel Environment Variables:

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º–æ–π –ø–æ—Ä—Ç 5432 (–Ω–µ pooler 6543):**

```
postgresql://postgres.wftzanfybiwxuvpjpizh:W4S4YrBcTA5ZyxWS@aws-1-us-east-1.pooler.supabase.com:5432/postgres?sslmode=require
```

**–í–∞–∂–Ω–æ:** 
- –ó–∞–º–µ–Ω–∏—Ç–µ `postgres://` –Ω–∞ `postgresql://`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ä—Ç `5432` (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ) –≤–º–µ—Å—Ç–æ `6543` (pooler)
- Pooler –ø–æ—Ä—Ç –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ Prisma

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å DATABASE_URL –≤ Vercel

1. –û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. Settings ‚Üí Environment Variables
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:

   **Name:** `DATABASE_URL`
   
   **Value:** 
   ```
   postgresql://postgres.wftzanfybiwxuvpjpizh:W4S4YrBcTA5ZyxWS@aws-1-us-east-1.pooler.supabase.com:5432/postgres?sslmode=require
   ```
   
   **‚ö†Ô∏è –í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ä—Ç `5432` (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ), –∞ –Ω–µ `6543` (pooler)

4. –í—ã–±–µ—Ä–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: **Production**, **Preview**, **Development** (–≤—Å–µ —Ç—Ä–∏!)
5. –ù–∞–∂–º–∏—Ç–µ **Save**

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

**–í–∞—Ä–∏–∞–Ω—Ç A: –õ–æ–∫–∞–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ DATABASE_URL –ª–æ–∫–∞–ª—å–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ä—Ç 5432)
export DATABASE_URL="postgresql://postgres.wftzanfybiwxuvpjpizh:W4S4YrBcTA5ZyxWS@aws-1-us-east-1.pooler.supabase.com:5432/postgres?sslmode=require"

# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ backend
cd backend

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Å—Ö–µ–º—É (–µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –µ—â—ë –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)
npx prisma db push

# 4. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
npx prisma db pull
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ `prisma db push`, –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `prisma migrate deploy` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π.

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Vercel CLI**

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ø—Ä–æ–µ–∫—Ç—É
vercel link

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
vercel env pull .env.local

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cd backend
export DATABASE_URL=$(grep DATABASE_URL ../.env.local | cut -d '=' -f2-)
npx prisma migrate deploy
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
cd backend
export DATABASE_URL="postgresql://postgres.wftzanfybiwxuvpjpizh:W4S4YrBcTA5ZyxWS@aws-1-us-east-1.pooler.supabase.com:5432/postgres?sslmode=require"
npx prisma db pull
```

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.

### –®–∞–≥ 4: –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:
1. Vercel Dashboard ‚Üí Deployments
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π ‚Üí —Ç—Ä–∏ —Ç–æ—á–∫–∏ (‚ãØ) ‚Üí **Redeploy**

–ò–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–µ–ø–ª–æ—è –ø–æ—Å–ª–µ push –≤ GitHub.

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. Health Check
```
https://your-project.vercel.app/api/health
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: `{"status":"ok",...}`

### 2. API Test
```
GET https://your-project.vercel.app/api/habits
Headers:
  x-telegram-id: 123456789
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: `[]` (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤) –∏–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—ã—á–µ–∫

### 3. Frontend
```
https://your-project.vercel.app
```
–î–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## ‚ùå –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "P1001: Can't reach database server"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `postgresql://`, –∞ –Ω–µ `postgres://`)
- SSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `postgresql://`
2. –î–æ–±–∞–≤—å—Ç–µ `?sslmode=require` –≤ –∫–æ–Ω—Ü–µ URL
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase ‚Üí Settings ‚Üí Database ‚Üí Connection Pooling

### –û—à–∏–±–∫–∞: "P1000: Authentication failed"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
- URL —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Connection String –∑–∞–Ω–æ–≤–æ –∏–∑ Supabase
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–æ–ª—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω

### –û—à–∏–±–∫–∞: "relation does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
```bash
export DATABASE_URL="postgresql://..."
cd backend
npx prisma migrate deploy
```

---

## üìù –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã

```bash
export DATABASE_URL="postgresql://postgres.wftzanfybiwxuvpjpizh:W4S4YrBcTA5ZyxWS@aws-1-us-east-1.pooler.supabase.com:5432/postgres?sslmode=require" && cd backend && npx prisma db push && echo "‚úÖ –°—Ö–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!"
```

**‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!** –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ `prisma db push`.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** 
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ DATABASE_URL –≤ Git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ Environment Variables –≤ Vercel
- DATABASE_URL —É–∂–µ –≤ `.gitignore` ‚úÖ

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [ ] DATABASE_URL –¥–æ–±–∞–≤–ª–µ–Ω –≤ Vercel (–¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π)
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç `postgresql://` (–Ω–µ `postgres://`)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã: `npx prisma migrate deploy`
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: `npx prisma db pull`
- [ ] –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–¥–µ–ø–ª–æ–µ–Ω –≤ Vercel
- [ ] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç: `/api/health`
- [ ] API —Ä–∞–±–æ—Ç–∞–µ—Ç: `/api/habits`

---

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!** üöÄ
